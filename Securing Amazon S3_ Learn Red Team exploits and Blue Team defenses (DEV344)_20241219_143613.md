# Summary of AWS re_Invent 2024 - Securing Amazon S3_ Learn Red Team exploits and Blue Team defenses (DEV344).txt

# AWS re:Invent 2024 - Securing Amazon S3: Learn Red Team Exploits and Blue Team Defenses

## Summary

This session covers the Red Team tactics for exploiting Amazon S3 and the Blue Team defenses to protect against such attacks. The key points discussed are:

### Red Team vs. Blue Team

- **Red Team**: Their goal is to gain access to sensitive data (e.g., crown jewel data from S3) using stealthy techniques to avoid detection.
- **Blue Team**: Their goal is to detect and stop the Red Team's attacks.

### Amazon S3 Encryption Types

- **Recommended**: Customer-managed KMS key, customer-provided key, or dual-layer KMS key.
- **More Secure**: Customer-managed KMS key with disabled IAM permissions and separation of duties (key administrator and key user).

### Red Team Tactic: Privilege Escalation via CloudBootHook

1. Assume the role of a junior system admin with limited permissions (e.g., start/stop EC2 instances).
2. Stop an EC2 instance with a role that has access to the target S3 bucket.
3. Modify the instance's user data to include a CloudBootHook that retrieves temporary credentials and sends them to a command and control server.
4. Start the instance, retrieve the temporary credentials, and use them to access the encrypted data in the S3 bucket.

### Blue Team Defenses

- **AWS Config Rules for S3**: Monitor S3 bucket encryption types and mark non-compliant buckets.
- **Custom AWS Config Rule**: Check for default encryption, IAM permissions on KMS keys, and separation of duties.
- **EventBridge and Lambda**: Detect changes to EC2 instance user data and automate responses (e.g., revoke sessions, quarantine instances).
- **VPC Endpoint and S3 Bucket Policy**: Restrict S3 access to specific VPC endpoints, preventing remote access even with valid credentials.

## Key Insights

- Protecting the KMS key is crucial, as without the key, data in S3 cannot be decrypted.
- Implementing separation of duties and disabling IAM permissions on KMS keys enhances security.
- Red Teams can leverage techniques like CloudBootHook to escalate privileges and gain unauthorized access to sensitive data.
- Blue Teams should employ a multi-layered defense strategy, including monitoring, automation, and network-level controls, to detect and prevent Red Team attacks.

## Conclusion

This session highlights the importance of securing Amazon S3 and provides valuable insights into Red Team tactics and Blue Team defenses. By understanding the potential attack vectors and implementing robust security measures, organizations can better protect their sensitive data stored in S3.